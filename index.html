<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Driver_Introvert</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* WARNA UTAMA */
        :root {
            --shopeefood-orange: #EE4D2D;
            --shopeefood-light-orange: #FF7043;
            --shopeefood-dark-orange: #CC3D20;
            --delete-red: #D9534F; /* Warna merah untuk tombol hapus */
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #fffaf5;
            display: flex;
            padding-top: 55px; /* Jarak untuk navbar fixed */
        }
         
        /* ================================================= */
        /* --- STYLE SPLASH SCREEN BARU --- */
        /* ================================================= */
        #initial-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--shopeefood-orange); /* Latar belakang oranye penuh */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999; /* Pastikan di atas segalanya */
            opacity: 1;
            transition: opacity 1s ease-out; /* Transisi saat menghilang */
            color: white;
            font-family: 'Poppins', sans-serif; /* Menggunakan font yang stylish */
        }
        
        /* Animasi Ikon Motor */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-7px); }
        }

        #splash-icon {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 2s infinite; /* Animasi bouncing */
        }
        
        #splash-text {
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-top: 10px;
        }

        /* Kelas untuk menyembunyikan konten utama saat splash aktif */
        body.splash-active .content, body.splash-active .navbar {
             visibility: hidden;
        }
        body.splash-active {
            padding-top: 0;
        }
        
        /* ================================================= */
        /* --- STYLE APLIKASI UTAMA (TIDAK BERUBAH) --- */
        /* ================================================= */

        .navbar {
            background-color: var(--shopeefood-orange);
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 0;
            font-weight: bold;
            font-size: 10px;
            transition: background-color 0.3s;
            flex-grow: 1;
            min-width: 0;
        }
        .navbar a i {
            font-size: 20px;
            margin-bottom: 3px;
        }
        .navbar a:hover {
            background-color: var(--shopeefood-dark-orange);
        }

        .content {
            margin: auto;
            padding: 20px 15px;
            width: 100%;
            max-width: 520px;
            box-sizing: border-box;
        }
        .card {
            background: #fff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        h2 {
            text-align: center;
            color: var(--shopeefood-orange);
            margin-top: 0;
        }
        label {
            font-weight: 600;
            font-size: 14px;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0 14px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea[readonly] {
            background: #f9f9f9;
            color: #555;
        }
        button {
            width: 100%;
            background: var(--shopeefood-orange);
            border: none;
            padding: 12px;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--shopeefood-dark-orange);
        }
        .info {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
        }
        .jumlah {
            color: var(--shopeefood-orange);
            font-size: 20px;
        }
        .tarif-total {
            text-align: center;
            margin-top: 10px;
            font-size: 18px;
            color: var(--shopeefood-dark-orange);
        }
        #map {
            margin-top: 15px;
            width: 100%;
            height: 250px;
            border-radius: 12px;
            background: #fff3e6;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .riwayat {
            margin-top: 20px;
        }
        .riwayat h3 {
            margin-bottom: 10px;
            color: var(--shopeefood-orange);
        }
        .riwayat-item {
            background: #fff7f2;
            border: 1px solid #ffd9b3;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .riwayat-item > * {
            margin-bottom: 4px;
        }
        .riwayat-item a {
            color: var(--shopeefood-dark-orange);
            text-decoration: none;
        }
        .riwayat-item button {
            margin-top: 6px;
            padding: 4px 8px;
            font-size: 12px;
            background: var(--delete-red);
            width: auto;
            align-self: flex-start;
        }
        #jam-digital {
            position: fixed;
            top: 5px;
            right: 10px;
            background: var(--shopeefood-dark-orange);
            color: white;
            font-size: 8px;
            font-weight: bold;
            padding: 5px 8px;
            border-radius: 8px;
            font-family: monospace;
            z-index: 9999;
        }
    </style>
</head>
<body class="splash-active">
    
    <div id="initial-splash">
        <i class="fa-solid fa-motorcycle" id="splash-icon"></i> 
        <div id="splash-text">Driver_Introvert</div>
    </div>
    <div class="navbar">
        <a href="https://mbahwibuuu-commits.github.io/shopay/index.html">
            <i class="fa-solid fa-home"></i> Home
        </a>
             <a href=" https://mbahwibuuu-commits.github.io/shopay/sopay.html">
            <i class="fa-solid fa-wallet"></i> Top Up
        </a>
        <a href="https://drivermager.ct.ws/index.php">
            <i class="fa-solid fa-comments"></i> Chat
        </a>
        <a href="https://drivermager.ct.ws/cs.php">
            <i class="fa-solid fa-user-gear"></i> Input CS
        </a>
    </div>

  <div class="content">
    <div id="jam-digital"></div>
    <div class="card">
        <p> </p>
      <h2><i class="fa-solid fa-motorcycle"></i> Driver_Introvert</h2>
 <center><div class="riwayat">
    <h3>MagerSaveNomor</h3>
 </div></center>
      <form onsubmit="cekDuplikat(event)">
        <label>Nomor HP Customer:</label>
        <input type="tel" id="nomor" required oninput="this.value=this.value.replace(/[^0-9]/g,'')" />

        <label>Nama (opsional):</label>
        <input type="text" id="nama" />

        <label>Jenis Pesan:</label>
        <select id="jenis" required onchange="setPesan()">
          <option value="tanya">Tanya Titik</option>
          <option value="info">Info Sudah Sampai</option>
          <option value="custom">Pesan Custom</option>
        </select>

        <label>Pesan:</label>
        <textarea id="pesan" rows="3"></textarea>

        <label>Tarif (Rp):</label>
        <input type="number" id="tarif"  />

        <input type="hidden" id="latitude" />
        <input type="hidden" id="longitude" />

        <button type="submit">Kirim ke WhatsApp</button>
      </form>

      <div class="info">
        Total order: <span class="jumlah" id="jml_order">0</span>
      </div>
      <div class="tarif-total">
        Total Tarif: Rp<span id="total_tarif">0</span>
      </div>

      <div id="map">Menunggu izin lokasiâ€¦</div>

      <div class="riwayat">
        <h3>Riwayat Order</h3>
        <label>Filter Tanggal:</label>
        <input type="date" id="filterTanggal" onchange="renderRiwayat()" />
        <div id="riwayatList"></div>
      </div>
    </div>
  </div>

  <script>
    // set pesan otomatis
    function setPesan() {
      let jenis = document.getElementById("jenis").value;
      let pesanBox = document.getElementById("pesan");
      if (jenis === "tanya") {
        pesanBox.value = "Permisi kak, saya dari ShopeeFood. Apakah titik pengantaran sudah sesuai aplikasi?";
        pesanBox.readOnly = true;
      } else if (jenis === "info") {
        pesanBox.value = "Permisi kak, saya dari ShopeeFood. Saya sudah sampai di titik pengantaran.";
        pesanBox.readOnly = true;
      } else {
        pesanBox.value = "";
        pesanBox.readOnly = false;
      }
    }
    setPesan();

    function rapikan_nomor(nomor) {
      nomor = nomor.replace(/[^0-9]/g, '');
      if (nomor.startsWith("0")) nomor = "62" + nomor.substring(1);
      if (!nomor.startsWith("62")) nomor = "62" + nomor;
      return nomor;
    }

    // Perbaikan sensor: 4 depan disensor
    function sensorNomor(nomor) {
      if (!nomor || nomor.length < 5) return nomor;
      // Menampilkan 4 digit depan, sisanya *****
      return nomor.substring(0, 4) + "****" + nomor.substring(nomor.length - 2); 
    }

    // Perbaikan sensor: 2 depan ditampilkan, sisanya disensor
    function sensorNama(nama) {
      if (!nama) return "#";
      let bersih = nama.trim().split(" ")[0];
      if (bersih.length <= 2) return bersih;
      return bersih.substring(0, 2) + "**";
    }

    function cekDuplikat(e) {
      e.preventDefault();
      let nomor = rapikan_nomor(document.getElementById("nomor").value);
      let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];
      let duplikat = riwayat.find(r => r.nomor === nomor);
      if (duplikat) {
        Swal.fire({
          title: "Nomor sudah pernah diinput",
          text: "Tetap kirim pesan ke WhatsApp?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Lanjut",
          cancelButtonText: "Batal"
        }).then(result => { if (result.isConfirmed) kirimWA(); });
      } else {
        kirimWA();
      }
    }

    function kirimWA() {
      let nomor = rapikan_nomor(document.getElementById("nomor").value);
      let nama = document.getElementById("nama").value || "#";
      let jenis = document.getElementById("jenis").value;
      let pesan = document.getElementById("pesan").value;
      let tarif = document.getElementById("tarif").value;
      let latitude = document.getElementById("latitude").value;
      let longitude = document.getElementById("longitude").value;

      if (jenis === "info" && latitude && longitude) {
        // Menggunakan format link Google Maps yang standar
        pesan += `\n\nLokasi saya: https://maps.google.com/maps?q=${latitude},${longitude}`;
      }

      let phone = nomor.replace(/\D/g, '');
      if (phone.startsWith('0')) phone = phone.substring(1);
      if (phone.startsWith('62')) phone = phone.substring(2);

      let encodedMsg = encodeURIComponent(pesan);
      // Menggunakan format standar wa.me
      let waUrl = `https://wa.me/62${phone}?text=${encodedMsg}`;

      window.open(waUrl, '_blank'); // Buka di tab baru

      let order = {
        nomor, nama, tarif, latitude, longitude,
        waktu: new Date().toLocaleTimeString('id-ID', { hour12: false }),
        tanggal: new Date().toISOString().split("T")[0]
      };
      let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];
      riwayat.unshift(order);
      localStorage.setItem("riwayat", JSON.stringify(riwayat));
      renderRiwayat();
    }

    function hapusRiwayat(index) {
      let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];
      riwayat.splice(index, 1);
      localStorage.setItem("riwayat", JSON.stringify(riwayat));
      renderRiwayat();
    }

    function openWAFromRiwayat(nomor, nama) {
      let phone = nomor.replace(/\D/g, '');
      if (phone.startsWith('0')) phone = phone.substring(1);
      if (phone.startsWith('62')) phone = phone.substring(2);
      let msg = encodeURIComponent(`Halo, permisi kak ${nama}`);
      let waUrl = `https://wa.me/62${phone}?text=${msg}`;
      window.open(waUrl, '_blank');
    }

    function renderRiwayat() {
      let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];
      let list = document.getElementById("riwayatList");
      list.innerHTML = "";
      let filter = document.getElementById("filterTanggal").value;
      let filtered = riwayat.filter(r => !filter || r.tanggal === filter);
      let tampil = filter ? filtered : filtered.slice(0, 15);
      let totalTarif = 0;

      tampil.forEach((r, i) => {
        totalTarif += Number(r.tarif);
        let nomorTampil = sensorNomor(r.nomor);
        let namaTampil = sensorNama(r.nama);
        let div = document.createElement("div");
        div.className = "riwayat-item";
        
        let linkLokasi = (r.latitude && r.longitude) 
            ? `<a href="https://maps.google.com/maps?q=${r.latitude},${r.longitude}" target="_blank">Lihat Lokasi</a>`
            : "Lokasi tidak tersedia";

        div.innerHTML = `
          <span><b>${i+1}.</b> <i class="fas fa-phone"></i> 
          <a href="javascript:void(0)" onclick="openWAFromRiwayat('${r.nomor}','${r.nama}')">${nomorTampil}</a> - ${namaTampil}</span>
          
          <span style="font-weight: bold;"><i class="fas fa-money-bill-wave"></i> Rp${Number(r.tarif).toLocaleString("id-ID")}</span>
          
          <span style="font-size: 12px; color: #555;"><i class="fas fa-calendar-day"></i> ${r.tanggal} <i class="fas fa-clock"></i> ${r.waktu}</span>
          
          <span style="font-size: 12px; color: #555;"><i class="fas fa-map-marker-alt"></i> ${linkLokasi}</span>
          
          <button onclick="hapusRiwayat(${i})"><i class="fas fa-trash"></i> Hapus</button>
        `;
        list.appendChild(div);
      });
      document.getElementById("jml_order").innerText = filtered.length;
      document.getElementById("total_tarif").innerText = totalTarif.toLocaleString("id-ID");
    }

    // GeoLocation dan Map
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        document.getElementById('latitude').value = pos.coords.latitude;
        document.getElementById('longitude').value = pos.coords.longitude;
        document.getElementById('map').innerHTML =
          `<iframe width='100%' height='250' style='border:0;border-radius:12px;' loading='lazy' allowfullscreen 
            src='https://maps.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}&hl=id&z=15&output=embed'></iframe>`;
      }, err => {
        document.getElementById('map').textContent = "Gagal ambil lokasi: " + err.message;
      });
    }

    function updateJam() {
      let now = new Date();
      document.getElementById("jam-digital").innerText =
        now.toLocaleTimeString('id-ID', { hour12: false });
    }
    
    // =================================================
    // --- FUNGSI SPLASH SCREEN ---
    // =================================================
    window.onload = function() {
        const splash = document.getElementById('initial-splash');
        const body = document.body;
        
        // Atur durasi tampilan splash screen (misalnya 3 detik)
        const splashDuration = 3000; 
        const fadeDuration = 1000; // Durasi transisi opacity 1 detik

        setTimeout(() => {
            // 1. Mulai transisi opacity untuk menghilangkan splash
            splash.style.opacity = '0';
            
            // 2. Setelah transisi selesai, hapus splash dan tampilkan konten utama
            setTimeout(() => {
                splash.style.display = 'none';
                body.classList.remove('splash-active'); // Hapus class untuk menampilkan konten
                body.style.paddingTop = '55px'; // Kembalikan padding body
            }, fadeDuration);

        }, splashDuration);
        
        // Fungsi inisialisasi aplikasi
        setInterval(updateJam, 1000);
        updateJam();
        renderRiwayat();
    };
  </script>
</body>
</html>
